<!-- Main Header - Teljes komponens -->
<nav class="main-navbar">
  <!-- Container wrapper -->
  <div class="nav-container">
    <!-- Logo bal oldalon -->
    <div class="nav-logo">
      <a routerLink="/">
        <img src="{{ imgSrc }}" alt="CarComps main brand logo" />
      </a>
    </div>

    <!-- Search bar középen -->
    <div class="nav-search">
      <form class="search-form" [class.has-results]="showDropdown()" (ngSubmit)="onSearchSubmit()">
        <i class="fa-solid fa-magnifying-glass search-icon"></i>
        <input
          type="search"
          class="search-input"
          placeholder="Keresés autóalkatrészek között..."
          [formControl]="searchControl"
          (blur)="closeDropdown()"
          autocomplete="off"
        />

        <!-- Loading spinner -->
        @if (isSearching()) {
        <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
        }

        <!-- Search results dropdown -->
        @if (showDropdown() && searchResults().length > 0) {
        <div class="search-dropdown">
          <ul class="search-results">
            @for (result of searchResults(); track result.id) {
            <li class="search-result-item" (mousedown)="selectResult(result)">
              <div class="result-info">
                <div class="result-name">{{ result.name }}</div>
                <div class="result-category">{{ result.category }}</div>
              </div>
              <div class="result-price">{{ result.price | number : '1.0-0' }} Ft</div>
            </li>
            }
          </ul>
        </div>
        }

        <!-- Nincs találat üzenet -->
        @if (showDropdown() && !isSearching() && searchResults().length === 0 && searchControl.value
        && searchControl.value.trim().length > 0) {
        <div class="search-dropdown">
          <div class="no-results">
            <i class="fa-solid fa-circle-exclamation"></i>
            <p>Nincs találat</p>
          </div>
        </div>
        }
      </form>
    </div>

    <!-- Ikonok jobb oldalon -->
    <ul class="nav-icons">
      <li class="nav-item">
        <a class="nav-link" routerLink="/warehouse" title="Raktár">
          <i class="fa-solid fa-warehouse"></i>
        </a>
      </li>

      <!-- ==========================================
           CART HOVER MENU
           ========================================== -->
      <li class="nav-item cart-item">
        <a class="nav-link" routerLink="/cart" title="Kosár">
          <i class="fa-solid fa-cart-shopping"></i>
          <!-- Badge - termékek száma -->
          @if (isLoggedIn() && cartItemCount() > 0) {
          <span class="cart-badge">{{ cartItemCount() }}</span>
          }
        </a>

        <!-- CART HOVER DROPDOWN -->
        <div class="cart-dropdown">
          <!-- 1. NINCS BEJELENTKEZVE -->
          @if (!isLoggedIn()) {
          <div class="cart-empty-state">
            <i class="fa-solid fa-user-lock"></i>
            <p class="cart-message">Jelentkezz be a kosár használatához</p>
            <a routerLink="/login" class="cart-login-btn">Bejelentkezés</a>
          </div>
          }

          <!-- 2. ÜRES KOSÁR -->
          @else if (cartItems().length === 0) {
          <div class="cart-empty-state">
            <i class="fa-solid fa-cart-shopping"></i>
            <p class="cart-message">A kosár üres</p>
            <a routerLink="/" class="cart-browse-btn">Böngészés</a>
          </div>
          }

          <!-- 3. VAN TERMÉK A KOSÁRBAN -->
          @else {
          <div class="cart-content">
            <!-- Header -->
            <div class="cart-header">
              <h3>Kosár ({{ cartItemCount() }} termék)</h3>
            </div>

            <!-- Termékek lista -->
            <div class="cart-items">
              @for (item of cartItems(); track item.id) {
              <div class="cart-item-row">
                <!-- Termék kép -->
                <div class="cart-item-image">
                  <img [src]="item.imageUrl || '/assets/placeholder.png'" [alt]="item.name" />
                </div>

                <!-- Termék info -->
                <div class="cart-item-info">
                  <div class="cart-item-name">{{ item.name }}</div>
                  <div class="cart-item-quantity">{{ item.quantity }} db</div>
                </div>

                <!-- Ár -->
                <div class="cart-item-price">
                  {{ item.price * item.quantity | number : '1.0-0' }} Ft
                </div>

                <!-- Törlés gomb -->
                <button
                  class="cart-item-remove"
                  (click)="removeFromCart(item.id)"
                  title="Eltávolítás"
                >
                  <i class="fa-solid fa-xmark"></i>
                </button>
              </div>
              }
            </div>

            <!-- Footer - Összesen + Gombok -->
            <div class="cart-footer">
              <div class="cart-total">
                <span>Összesen:</span>
                <span class="cart-total-price">{{ cartTotal() | number : '1.0-0' }} Ft</span>
              </div>

              <div class="cart-actions">
                <a routerLink="/cart" class="cart-view-btn">Kosár megtekintése</a>
                <a routerLink="/checkout" class="cart-checkout-btn">Pénztár</a>
              </div>
            </div>
          </div>
          }
        </div>
      </li>
      <!-- CART HOVER MENU VÉGE -->

      <!-- PROFIL IKON -->
      <li class="nav-item">
        @if (isLoggedIn()) {
        <!-- BE van jelentkezve → Profil -->
        <a class="nav-link" routerLink="/profile" title="Profil">
          <i class="fa-solid fa-user"></i>
        </a>
        } @else {
        <!-- NINCS bejelentkezve → REGISZTRÁCIÓ -->
        <a class="nav-link" routerLink="/registration" title="Regisztráció">
          <i class="fa-solid fa-user"></i>
        </a>
        }
      </li>
    </ul>
  </div>

  <!-- ==========================================
       VEHICLE SELECTOR - Alsó rész
       ========================================== -->
  <div class="vehicle-selector-container">
    <div class="vehicle-selector-body">
      <ul>
        <li>
          <i class="fa-solid fa-car"></i>
          <span>Személygépjármű</span>
        </li>
        <li>
          <i class="fa-solid fa-motorcycle"></i>
          <span>Motorkerékpár</span>
        </li>
        <li>
          <i class="fa-solid fa-truck"></i>
          <span>Tehergépjármű</span>
        </li>
      </ul>
    </div>
  </div>
</nav>
